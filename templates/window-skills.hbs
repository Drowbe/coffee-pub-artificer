{{!-- Artificer Skills - Stacked panels left, details right. Badge = skill details; perk = perk details. --}}

<div class="skills-window-root">
    <!-- Header -->
    <header class="skills-window-header">
        <div class="skills-window-header-content">
            <div class="skills-window-header-icon">
                {{#if actorImg}}
                <img src="{{actorImg}}" alt="" class="skills-window-header-portrait" />
                {{else}}
                <i class="fa-solid fa-seedling"></i>
                {{/if}}
            </div>
            <div class="skills-window-header-title-block">
                <div class="skills-window-header-title">Artificer Skills</div>
                <div class="skills-window-header-actor">{{#if actorName}}{{actorName}}{{else}}Select a character{{/if}}</div>
            </div>
            <div class="skills-window-header-right">
                <div class="artificer-toggle-container skills-window-toggle-hide">
                    {{> partials/toggle name=toggleHideUnavailableId labelLeft="Hide Unavailable" checked=hideUnavailable}}
                </div>
                <div class="skills-window-header-points">
                    <span class="skills-window-points-label">Points</span>
                    {{#if canEditPoints}}
                    <button type="button" class="skills-window-points-value skills-window-points-edit" data-action="editPoints" title="Click to edit (GM)">{{availablePoints}}</button>
                    {{else}}
                    <span class="skills-window-points-value">{{availablePoints}}</span>
                    {{/if}}
                </div>
            </div>
        </div>
    </header>

    <div class="skills-window-body">
        <!-- Skill panels -->
            <div class="skills-window-panels">
            {{#each skillPaths}}
            <section class="skills-panel {{#unless this.skillEnabled}}skills-panel-disabled{{/unless}}{{#unless this.hasKit}}{{#if this.skillKit}} skills-panel-kit-missing{{/if}}{{/unless}}" data-skill="{{this.id}}" style="background-color: {{this.skillPanelColor}};"{{#unless this.hasKit}}{{#if this.skillKit}} title="Required kit missing: {{this.skillKit}}"{{/if}}{{/unless}}>
                <div class="skills-panel-label">
                    <span class="skills-panel-label-left">
                        <span class="skills-panel-label-text">{{this.name}}</span>
                    </span>
                    <span class="skills-panel-label-dots">
                        {{#each this.totalCostDots}}
                        <i class="fa-solid fa-circle skills-panel-dot{{#if this.learned}} dot-learned{{/if}}"></i>
                        {{/each}}
                    </span>
                </div>
                <div class="skills-panel-row">
                <div class="skills-panel-badge {{#if this.badgeSelected}}skills-panel-badge-selected{{/if}}" data-skill="{{this.id}}" data-action="selectSkillBadge" title="{{this.name}}" style="background-color: {{this.skillBadgeColor}};">
                    <img src="{{this.img}}" alt="{{this.name}}" class="skills-panel-badge-img" />
                    <i class="fa-solid fa-hammer skills-panel-badge-craft-icon{{#if this.hasKit}} skills-panel-badge-craft-has-kit{{/if}}" aria-hidden="true" title="{{#if this.hasKit}}Has required kit{{else}}Missing required kit{{/if}}"></i>
                </div>
                <div class="skills-panel-perks">
                    {{#each this.perks}}
                    {{#if this.empty}}
                    <div class="skills-perk skills-perk-empty"></div>
                    {{else}}
                    <div class="skills-perk {{#if this.selected}}skills-perk-selected{{/if}}{{#if this.perkApplied}} skills-perk-learned{{/if}}" data-skill="{{../this.id}}" data-perk-index="{{this.perkIndex}}" title="{{this.name}}{{#if this.requirement}} â€” {{this.requirement}}{{/if}}"{{#if this.perkApplied}} style="background-color: {{this.perkLearnedBackgroundColor}};"{{/if}}>
                        {{#if this.iconClass}}<i class="{{this.iconClass}} skills-perk-icon"></i>{{/if}}
                        <span class="skills-perk-number{{#if this.perkApplied}} perk-applied{{/if}}">{{this.displayValue}}</span>
                    </div>
                    {{/if}}
                    {{/each}}
                </div>
                </div>
            </section>
            {{/each}}
        </div>

        <!-- Details pane -->
        <aside class="skills-window-details">
            <section class="skills-zone-section">
                <h3 class="skills-zone-section-title">Details</h3>
                <div class="skills-details-content">
                    {{#if selectedDetail}}
                        {{#if selectedDetail.perk}}
                        <div class="skills-detail-name">{{#if selectedDetail.perk.iconClass}}<i class="{{selectedDetail.perk.iconClass}} skills-detail-perk-icon"></i> {{/if}}{{selectedDetail.perk.name}}{{#unless selectedDetail.perk.name}}Perk {{selectedDetail.perk.index}}{{/unless}}</div>
                        <div class="skills-detail-rows">
                            <div class="skills-detail-row"><span class="skills-detail-label">Requirements:</span><span class="skills-detail-value">{{selectedDetail.requirementLabel}}</span></div>
                            <div class="skills-detail-row"><span class="skills-detail-label">Cost:</span><span class="skills-detail-value">{{selectedDetail.costDisplay}} point(s)</span></div>
                        </div>
                        {{#if selectedDetail.kitMissing}}
                        <div class="skills-detail-kit-missing">Required kit is missing. Add {{selectedDetail.skill.skillKit}} to inventory to learn perks.</div>
                        {{/if}}
                        {{#if selectedDetail.perk.description}}
                        <div class="skills-detail-description">{{{selectedDetail.perk.description}}}</div>
                        {{/if}}
                        {{#if selectedDetail.benefits}}
                        {{#if selectedDetail.benefits.length}}
                        <h4 class="skills-detail-benefits-title">Benefits</h4>
                        <ul class="skills-detail-benefits-list">
                            {{#each selectedDetail.benefits}}
                            <li class="skills-detail-benefit">
                                <strong class="skills-detail-benefit-title">{{this.title}}</strong>
                                {{#if this.description}}<span class="skills-detail-benefit-desc">{{this.description}}</span>{{/if}}
                            </li>
                            {{/each}}
                        </ul>
                        {{/if}}
                        {{/if}}
                        {{#if selectedDetail.canLearn}}
                        <button type="button" class="skills-detail-btn-learn" data-action="learnPerk" data-perk-id="{{selectedDetail.perk.perkID}}" title="Queue to learn">
                            <i class="fa-solid fa-plus"></i> Learn
                        </button>
                        {{/if}}
                        {{#if selectedDetail.showUnlearn}}
                        <button type="button" class="skills-detail-btn-unlearn" data-action="unlearnPerk" data-perk-id="{{selectedDetail.perk.perkID}}" title="{{#if selectedDetail.canUnlearn}}Queue to unlearn{{else}}{{selectedDetail.unlearnBlockedReason}}{{/if}}"{{#unless selectedDetail.canUnlearn}} disabled{{/unless}}>
                            <i class="fa-solid fa-minus"></i> Unlearn
                        </button>
                        {{#if selectedDetail.unlearnBlockedReason}}
                        <div class="skills-detail-unlearn-blocked">{{selectedDetail.unlearnBlockedReason}}</div>
                        {{/if}}
                        {{/if}}
                        {{else}}
                        <div class="skills-detail-name">{{selectedDetail.skill.name}}</div>
                        {{#if selectedDetail.skill.description}}
                        <div class="skills-detail-description">{{{selectedDetail.skill.description}}}</div>
                        {{/if}}
                        {{#if selectedDetail.skill.skillKit}}
                        <div class="skills-detail-rows">
                            <div class="skills-detail-row"><span class="skills-detail-label">Required Kit:</span><span class="skills-detail-value">{{selectedDetail.skill.skillKit}} <span class="skills-detail-kit-status {{#if selectedDetail.skill.hasKit}}skills-detail-kit-present{{else}}skills-detail-kit-missing{{/if}}">({{#if selectedDetail.skill.hasKit}}Owned{{else}}Missing{{/if}})</span></span></div>
                        </div>
                        {{/if}}
                        {{#if selectedDetail.skill.perks}}
                        <h4 class="skills-detail-perks-title">Perks</h4>
                        <div class="skills-detail-perks-list">
                            {{#each selectedDetail.skill.perks}}
                            {{#unless this.empty}}
                            <div class="skills-detail-perk-entry">
                                <div class="skills-detail-perk-name">{{#if this.iconClass}}<i class="{{this.iconClass}} skills-detail-perk-icon"></i> {{/if}}{{this.name}}</div>
                                {{#if this.description}}
                                <div class="skills-detail-perk-description">{{{this.description}}}</div>
                                {{/if}}
                            </div>
                            {{/unless}}
                            {{/each}}
                        </div>
                        {{/if}}
                        {{/if}}
                    {{else}}
                    <div class="skills-zone-empty">Select a skill or perk to see details.</div>
                    {{/if}}
                </div>
            </section>
        </aside>
    </div>

    <!-- Skill changes (shopping cart) -->
    {{#if hasPendingChanges}}
    <section class="skills-window-changes">
        <h3 class="skills-changes-title">Skill changes</h3>
        <ul class="skills-changes-list">
            {{#each skillChanges}}
            <li class="skills-changes-item {{#if this.isUnlearn}}skills-changes-unlearn{{else}}skills-changes-learn{{/if}}">
                <span class="skills-changes-name">{{this.name}}</span>
                <span class="skills-changes-delta">{{#if this.isUnlearn}}+{{this.pointsDelta}}{{else}}{{this.pointsDelta}}{{/if}}</span>
                {{#if this.isUnlearn}}
                <button type="button" class="skills-changes-remove" data-action="removePendingUnlearn" data-perk-id="{{this.perkID}}" title="Remove from changes"><i class="fa-solid fa-times"></i></button>
                {{else}}
                <button type="button" class="skills-changes-remove" data-action="removePendingLearn" data-perk-id="{{this.perkID}}" title="Remove from changes"><i class="fa-solid fa-times"></i></button>
                {{/if}}
            </li>
            {{/each}}
        </ul>
    </section>
    {{/if}}

    <!-- Action buttons --> 
    <section class="skills-window-buttons">
        <div class="skills-window-action-bar">
            <div class="skills-window-action-left"></div>
            <div class="skills-window-action-right">
                <button type="button" class="skills-window-btn-secondary" data-action="reset" title="Reset unapplied changes">
                    <i class="fa-solid fa-undo"></i> Reset
                </button>
                <button type="button" class="skills-window-btn-primary" data-action="apply" title="Apply skill point investments"{{#unless hasPendingChanges}} disabled{{/unless}}>
                    <i class="fa-solid fa-check"></i> Apply
                </button>
            </div>
        </div>
    </section>
</div>
