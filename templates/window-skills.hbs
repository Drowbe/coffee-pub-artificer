{{!-- Artificer Skills - Stacked panels left, details right. Badge = skill details; slot = slot details. --}}

<div class="skills-window-root">
    <!-- Header -->
    <header class="skills-window-header">
        <div class="skills-window-header-content">
            <div class="skills-window-header-icon">
                {{#if actorImg}}
                <img src="{{actorImg}}" alt="" class="skills-window-header-portrait" />
                {{else}}
                <i class="fa-solid fa-star"></i>
                {{/if}}
            </div>
            <div class="skills-window-header-title-block">
                <div class="skills-window-header-title">Artificer Skills</div>
                <div class="skills-window-header-actor">{{#if actorName}}{{actorName}}{{else}}Select a character{{/if}}</div>
            </div>
            <div class="skills-window-header-points">
                <span class="skills-window-points-label">Points</span>
                <span class="skills-window-points-value">{{availablePoints}}</span>
            </div>
        </div>
    </header>

    <div class="skills-window-body">
        <!-- Skill panels -->
            <div class="skills-window-panels">
            {{#each skillPaths}}
            <section class="skills-panel {{#unless this.skillEnabled}}skills-panel-disabled{{/unless}}" data-skill="{{this.id}}" style="background-color: {{this.skillPanelColor}};">
                <div class="skills-panel-label">
                    <span class="skills-panel-label-text">{{this.name}}</span>
                    <span class="skills-panel-label-dots">
                        {{#each this.totalCostDots}}
                        <i class="fa-solid fa-circle skills-panel-dot{{#if this.learned}} dot-learned{{/if}}"></i>
                        {{/each}}
                    </span>
                </div>
                <div class="skills-panel-row">
                <div class="skills-panel-badge {{#if this.badgeSelected}}skills-panel-badge-selected{{/if}}" data-skill="{{this.id}}" data-action="selectSkillBadge" title="{{this.name}}" style="background-color: {{this.skillBadgeColor}};">
                    <img src="{{this.img}}" alt="{{this.name}}" class="skills-panel-badge-img" />
                </div>
                <div class="skills-panel-slots">
                    {{#each this.slots}}
                    {{#if this.empty}}
                    <div class="skills-slot skills-slot-empty"></div>
                    {{else}}
                    <div class="skills-slot {{#if this.selected}}skills-slot-selected{{/if}}{{#if this.slotApplied}} skills-slot-learned{{/if}}" data-skill="{{../this.id}}" data-slot-index="{{this.slotIndex}}" title="{{this.name}}{{#if this.requirement}} â€” {{this.requirement}}{{/if}}"{{#if this.slotApplied}} style="background-color: {{this.slotSkillLearnedBackgroundColor}};"{{/if}}>
                        {{#if this.iconClass}}<i class="{{this.iconClass}} skills-slot-icon"></i>{{/if}}
                        <span class="skills-slot-number{{#if this.slotApplied}} slot-applied{{/if}}">{{this.displayValue}}</span>
                    </div>
                    {{/if}}
                    {{/each}}
                </div>
                </div>
            </section>
            {{/each}}
        </div>

        <!-- Details pane -->
        <aside class="skills-window-details">
            <section class="skills-zone-section">
                <h3 class="skills-zone-section-title">Details</h3>
                <div class="skills-details-content">
                    {{#if selectedDetail}}
                        {{#if selectedDetail.slot}}
                        <div class="skills-detail-name">{{#if selectedDetail.slot.iconClass}}<i class="{{selectedDetail.slot.iconClass}} skills-detail-slot-icon"></i> {{/if}}{{selectedDetail.slot.name}}{{#unless selectedDetail.slot.name}}Slot {{selectedDetail.slot.index}}{{/unless}}</div>
                        <div class="skills-detail-rows">
                            <div class="skills-detail-row"><span class="skills-detail-label">Requirements:</span><span class="skills-detail-value">{{selectedDetail.requirementLabel}}</span></div>
                            <div class="skills-detail-row"><span class="skills-detail-label">Cost:</span><span class="skills-detail-value">{{selectedDetail.costDisplay}} point(s)</span></div>
                        </div>
                        {{#if selectedDetail.kitMissing}}
                        <div class="skills-detail-kit-missing">Required kit is missing. Add {{selectedDetail.skill.skillKit}} to inventory to learn slots.</div>
                        {{/if}}
                        {{#if selectedDetail.slot.description}}
                        <div class="skills-detail-description">{{{selectedDetail.slot.description}}}</div>
                        {{/if}}
                        {{#if selectedDetail.canLearn}}
                        <button type="button" class="skills-detail-btn-learn" data-action="learnSlot" data-slot-id="{{selectedDetail.slot.slotID}}" title="Queue to learn">
                            <i class="fa-solid fa-plus"></i> Learn
                        </button>
                        {{/if}}
                        {{#if selectedDetail.showUnlearn}}
                        <button type="button" class="skills-detail-btn-unlearn" data-action="unlearnSlot" data-slot-id="{{selectedDetail.slot.slotID}}" title="{{#if selectedDetail.canUnlearn}}Queue to unlearn{{else}}{{selectedDetail.unlearnBlockedReason}}{{/if}}"{{#unless selectedDetail.canUnlearn}} disabled{{/unless}}>
                            <i class="fa-solid fa-minus"></i> Unlearn
                        </button>
                        {{#if selectedDetail.unlearnBlockedReason}}
                        <div class="skills-detail-unlearn-blocked">{{selectedDetail.unlearnBlockedReason}}</div>
                        {{/if}}
                        {{/if}}
                        {{else}}
                        <div class="skills-detail-name">{{selectedDetail.skill.name}}</div>
                        {{#if selectedDetail.skill.description}}
                        <div class="skills-detail-description">{{{selectedDetail.skill.description}}}</div>
                        {{/if}}
                        {{#if selectedDetail.skill.skillKit}}
                        <div class="skills-detail-rows">
                            <div class="skills-detail-row"><span class="skills-detail-label">Required Kit:</span><span class="skills-detail-value">{{selectedDetail.skill.skillKit}} <span class="skills-detail-kit-status {{#if selectedDetail.skill.hasKit}}skills-detail-kit-present{{else}}skills-detail-kit-missing{{/if}}">({{#if selectedDetail.skill.hasKit}}Owned{{else}}Missing{{/if}})</span></span></div>
                        </div>
                        {{/if}}
                        {{/if}}
                    {{else}}
                    <div class="skills-zone-empty">Select a skill or slot to see details.</div>
                    {{/if}}
                </div>
            </section>
        </aside>
    </div>

    <!-- Skill changes (shopping cart) -->
    {{#if hasPendingChanges}}
    <section class="skills-window-changes">
        <h3 class="skills-changes-title">Skill changes</h3>
        <ul class="skills-changes-list">
            {{#each skillChanges}}
            <li class="skills-changes-item {{#if this.isUnlearn}}skills-changes-unlearn{{else}}skills-changes-learn{{/if}}">
                <span class="skills-changes-name">{{this.name}}</span>
                <span class="skills-changes-delta">{{#if this.isUnlearn}}+{{this.pointsDelta}}{{else}}{{this.pointsDelta}}{{/if}}</span>
                {{#if this.isUnlearn}}
                <button type="button" class="skills-changes-remove" data-action="removePendingUnlearn" data-slot-id="{{this.slotID}}" title="Remove from changes"><i class="fa-solid fa-times"></i></button>
                {{else}}
                <button type="button" class="skills-changes-remove" data-action="removePendingLearn" data-slot-id="{{this.slotID}}" title="Remove from changes"><i class="fa-solid fa-times"></i></button>
                {{/if}}
            </li>
            {{/each}}
        </ul>
    </section>
    {{/if}}

    <!-- Action buttons --> 
    <section class="skills-window-buttons">
        <div class="skills-window-action-bar">
            <div class="skills-window-action-left"></div>
            <div class="skills-window-action-right">
                <button type="button" class="skills-window-btn-secondary" data-action="reset" title="Reset unapplied changes">
                    <i class="fa-solid fa-undo"></i> Reset
                </button>
                <button type="button" class="skills-window-btn-primary" data-action="apply" title="Apply skill point investments"{{#unless hasPendingChanges}} disabled{{/unless}}>
                    <i class="fa-solid fa-check"></i> Apply
                </button>
            </div>
        </div>
    </section>
</div>
